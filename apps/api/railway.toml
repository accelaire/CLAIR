[build]
builder = "NIXPACKS"
buildCommand = "cd ../.. && pnpm install --frozen-lockfile && pnpm --filter @clair/api db:generate && pnpm --filter @clair/api build"

[deploy]
# With 8GB RAM available, use 4GB heap for Node.js
startCommand = "node --max-old-space-size=4096 dist/index.js"
healthcheckPath = "/health"
healthcheckTimeout = 60
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[service]
internalPort = 3001
